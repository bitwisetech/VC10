<?xml version="1.0" encoding="UTF-8"?>

<PropertyList>
<filter>
  <type>gain</type>
  <name>FLT-init</name>
  <debug>false</debug>
  <enable>
    <condition>
      <less-than>
        <property>/sim/time/elapsed-sec</property>
        <value>4.000</value>
      </less-than>
    </condition>
  </enable>
  <input>
    <value>0.001</value>
  </input>
  <gain>1.000</gain>
  <output>/systems/tune/diff/EDFn-2</output>
  <output>/systems/tune/diff/EDFn-1</output>
  <output>/systems/tune/diff/EDFn</output>
  <output>/systems/tune/diff/EDFn-1</output>
  <output>/systems/tune/diff/EDFn</output>
  <output>/systems/tune/diff/alpha</output>
  <output>/systems/tune/diff/gamma</output>
  <output>/systems/tune/diff/td</output>
  <output>/systems/tune/diff/inited</output>
</filter>

<filter>
  <type>gain</type>
  <name>FLT-diff-inputProp</name>
  <input>
    <condition>
      <property>/systems/tune/pids-lat2-open</property>
    </condition>
    <property>/systems/tune/poke-latr-mark</property>
  </input>
	<input>
		<prop>/autopilot/internal/nav1-heading-error-deg</prop>
	</input>
  <gain>1.000</gain>
  <output>
    <property>/systems/tune/diff/input</property>
  </output>
</filter>

<filter>
  <type>gain</type>
  <name>FLT-diff-refrProp</name>
   <input>
    <value>0.000</value>
  </input>
  <gain>1.000</gain>
  <output>
    <property>/systems/tune/diff/refr</property>
  </output>
</filter>

<filter>
  <type>gain</type>
  <name>FLT-diff-scale</name>
  <input>
    <expression>
      <!-- TScale = ( Tframe / (alpha * Td) )  -->
      <div>
        <value>1.000</value>
        <product>
          <property>/sim/model-hz</property>
          <property>/systems/tune/diff/alpha</property>
          <property>/systems/tune/diff/td</property>
        </product>
      </div>
    </expression>
  </input>
  <gain>1.000</gain>
  <output>
    <property>/systems/tune/diff/scale</property>
  </output>
</filter>

<filter>
  <type>gain</type>
  <name>FLT-diff-gain</name>
  <input>
    <expression>
      <!--  TScale / ( Tscale + 1 )     -->
      <div>
        <property>/systems/tune/diff/scale</property>
        <sum>
          <property>/systems/tune/diff/scale</property>
          <value>1.000</value>
        </sum>
      </div>
    </expression>
  </input>
  <gain>1.000</gain>
  <output>
    <property>/systems/tune/diff/gain</property>
  </output>
</filter>

<filter>
  <type>gain</type>
  <name>FLT-diff-err</name>
  <input>
    <expression>
      <!--  diffErr = (gamma * refr)  - input    -->
      <difference>
        <product>
          <property>/systems/tune/diff/gamma</property>
          <property>/systems/tune/diff/refr</property>
        </product>
        <property>/systems/tune/diff/input</property>
      </difference>
    </expression>
  </input>
  <gain>1.000</gain>
  <output>
    <property>/systems/tune/diff/err</property>
  </output>
</filter>

<filter>
  <type>gain</type>
  <name>FLT-diff-EDFn</name>
  <debug>false</debug>
  <input>
    <!--  EDFn = (diffErr * diffGain) + EDFn-1   -->
    <expression>
    <sum>
      <product>
        <property>/systems/tune/diff/err</property>
        <property>/systems/tune/diff/gain</property>
      </product>
      <sum>
        <property>/systems/tune/diff/EDFn-1</property>
        <value>0.000</value>
      </sum>
    </sum>
    </expression>
  </input>
  <gain>1.000</gain>
  <output>
    <property>/systems/tune/diff/EDFn</property>
  </output>
</filter>

<!-- Save prev outputs -->
<filter>
  <type>gain</type>
  <name>FLT-diff-EDFn-2</name>
  <input>
    <property>/systems/tune/diff/EDFn-1</property>
  </input>
  <gain>1.000</gain>
  <output>
    <property>/systems/tune/diff/EDFn-2</property>
  </output>
</filter>

<filter>
  <type>gain</type>
  <name>FLT-diff-EDFn-1</name>
  <debug>false</debug>
  <input>
    <property>/systems/tune/diff/EDFn</property>
  </input>
  <gain>1.000</gain>
  <output>
    <property>/systems/tune/diff/EDFn-1</property>
  </output>
</filter>

<filter>
  <type>gain</type>
  <name>FLT-diff-term</name>
  <debug>false</debug>
  <input>
    <expression>
      <product>
        <!--  Td/Ts == Td * sample time -->
        <property>/sim/model-hz</property>
        <property>/systems/tune/diff/td</property>
        <difference>
          <sum>
            <property>/systems/tune/diff/EDFn</property>
            <property>/systems/tune/diff/EDFn-2</property>
          </sum>
          <product>
            <value>2.000</value>
            <property>/systems/tune/diff/EDFn-1</property>
          </product>
        </difference>
      </product>
    </expression>
  </input>
  <gain>1.000</gain>
  <output>
    <property>/systems/tune/diff/term</property>
  </output>
  <output>
    <property>/systems/tune/pids-vrt4-out</property>
  </output>
</filter>

</PropertyList>
